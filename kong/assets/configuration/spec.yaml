name: Kong
files:
- name: kong.yaml
  options:
  - template: init_config
    options:
    - template: init_config/openmetrics
  - template: instances
    multiple_instances_defined: true
    options:
    - name: openmetrics
      description: Metrics collected from the Prometheus Plugin
      options:
      - template: instances/openmetrics
        overrides:
          openmetrics_endpoint.enabled: true
          openmetrics_endpoint.required: false
          openmetrics_endpoint.display_priority: 1
          openmetrics_endpoint.value.example: http://localhost:8001/metrics
          extra_metrics.value.example:
          - kong_memory_workers_lua_vms_bytes: memory.workers.lua.vms.bytes
    - name: status_endpoint
      description: |
        Metrics collected from the Status endpoint.
        Note: Collecting metrics through the status endpoint can cause performance effects on your kong server.
        If you experience any issues consider adjusting the `min_collection_interval` of this instance.
      options:
      - name: kong_status_url
        description: URL where Kong exposes its status.
        value:
          example: http://localhost:8001/status/
          type: string
      - template: instances/http
      - template: instances/default
  - template: logs
    example:
    - type: file
      path: /var/log/nginx/access.log
      source: kong
      service: <SERVICE_NAME>
    - type: file
      path: /var/log/nginx/error.log
      source: kong
      service: <SERVICE_NAME>
